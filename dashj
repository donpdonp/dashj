#!/bin/bash

api() { curl -s 127.0.0.1:14002/api/$1; } 
DASHDATA=`api "dashboard"`

printf "node id : %s \n" `echo $DASHDATA | jq -r .data.nodeID`
printf "version : %s.%s.%s (%s)\n" `echo $DASHDATA | jq -r '.data.version.major, .data.version.minor, .data.version.patch, (if .data.upToDate then "latest" else "old" end)'`
printf "\n"

printf "bandwidth avail: %8.3fGB used: %-5.3fGB \n" `echo $DASHDATA | jq -r '.data.bandwidth| .available, .used'`
printf "     disk avail: %8.3fGB used: %-5.3fGB \n" `echo $DASHDATA | jq -r '.data.diskSpace| .available, .used'`
printf "\n"

FMT='%-6s %-9s %-8s %-9s %-8s %-10s %-10s %-10s %-9s %-9s\n'
printf "$FMT" sat-id audits score uptime score storage bandwidth

DATAFMT='%-6s %-4d/%-4d %-7.6f %4d/%-4d %-7.6f %8.3fGB %8.3fGB \n'
for sat in `echo $DASHDATA | jq -r '.data.satellites | map(.id) | sort[]'`
do
  SATDATA=`api "satellite/$sat"`
  printf "$DATAFMT" `echo $sat | cut -c1-6 ; echo $SATDATA| jq -r '.data | .audit.totalCount, .audit.successCount, .audit.score, .uptime.totalCount, .uptime.successCount, .uptime.score, .storageSummary/1024/1024/1024, .bandwidthSummary/1024/1024/1024'`
done

